##############################################################################
#----------------------------------------------------------------------------#
#                             -Pipeline-                                     #
# This script does the initial data-setup, parameter estimation and          #
# creates bootstrapped parameter estimates to be used in the Figures.R       #
#                               script.                                      #
#                                                                            #
#                                                                            #
#            Ecologically Sustainable Exploitation Rates                     #
#       - A multispecies approach for fisheries management -                 #
#        Säterberg, Casini & Gårdmark (2019) Fish & Fisheries                #  
#----------------------------------------------------------------------------#
##############################################################################

# clean workspace
rm(list=ls())

# set working directory (where all R-files are located)
setwd(choose.dir())

# source files
source('packages.R')
source('model_selection.R')
source('ESER.R')
source('Criteria.R')
source('Boot_param.R')
source('Figures.R')
source('dat.R')
source('Design_mat.R')

# load data
DAT <- dat()

# Create a design matrix for fitting MAR(1)-models   
Restrictions <- Design_mat()

# Estimate MAR(1)-model parameters
param <- model_selection(DAT,Restrictions)

# Bootstrap parameter sets
n_boot <- 500 # nb of bootstraps to create
Boot <- Boot_param(param,n_boot)

#########################################
#########################################
#---------------------------------------#
#------Ready to conduct analyses--------#
#----- run analyses in Figures.R -------#
#---------------------------------------#
#########################################
#########################################