#-----------------------------------------------------------------------#
#-----------------------------------------------------------------------#
#                                                                       #
#                           dat                                         #
#   - load and arrange baltic sea data to be used in ESER analyses -    #
#                                                                       #
#-----------------------------------------------------------------------#
#-----------------------------------------------------------------------#

dat <- function(){
path <- "Input/Baltic_data.xlsx"
ts_baltic <- read.xlsx(file=path,sheetIndex=1) # read data

nb_sp <- 3
X <- matrix(NA,27,nb_sp) # Time series data in columns
years <- c(1988:2014) # Years of data
t_length <- length(years) 

# Fish abundance data(X)
q4 <- ts_baltic[!is.na(ts_baltic[,4]),4] 
q1 <- ts_baltic[!is.na(ts_baltic[,4]),2]
a <- lm(q4~q1)
q1 <- ts_baltic[ts_baltic[,1]%in%c(1988:1997),2]
Cod <- c(predict(a,as.data.frame(q1)),q4) # use q4 data where avaliable and backcalculate using q1 for the first period
X[,1] <- Cod
X[,2:3] <- as.matrix(ts_baltic[ts_baltic[,1]%in%years,c(5,7)]) # pick out sprat and herring data 1+
X[,3] <- X[,3]/1000 # rescale to 1000 tonnes for  herring
colnames(X) <- c("Cod","Sprat","Herring") 

# Environmental covariate data(U)
nb_cov <- 2
U <- matrix(0,27,nb_cov) # Include environmental data here.
U_mean <- matrix(0,nb_cov,1) # this can be used to do projections
U_cov <- matrix(0,nb_cov,nb_cov) # # this can be used to do projections (assuming MVN env cov)

# Exploitation rate data (F)
F <- ts_baltic[ts_baltic[,1]%in%years,c(3,6,8)] # total landings
colnames(F) <- c("Cod","Sprat","Herring")
F[,3] <- F[,3]/1000 # Rescale catches to 1000 tonnes for herring
F <- F/X # We want a proxy for fishing mortality
F <- scale(F, center = TRUE, scale = apply(F, 2, sd, na.rm = TRUE)) # standardize data
F <- F[,] 

mean_survey <- colMeans(X) # mean of survey time series
mean_ln <- colMeans(log(X)) 
X <- log(X) # Gompertz formulation assumes logged densities
X <- apply(X,2,function(x) (x-mean(x))) # standardize data (don´t fit intercepts)

# All data in one list
DAT <- list(X,F,U,U_mean,U_cov,mean_ln,mean_survey)
names(DAT) <- c("X","F","U","U_mean","U_cov","mean_ln","mean_survey")
return(DAT)
}
#----------------------------------------------------------------------------------#
#----------------------------------------------------------------------------------#
